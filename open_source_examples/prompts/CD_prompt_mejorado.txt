CONVERSATION_DETECTION_PROMPT_MEJORADO = """Eres un analista experto en conversaciones con capacidad avanzada para detectar patrones sem√°nticos y temporales. Tu misi√≥n es analizar datos de mensajes y agruparlos en conversaciones distintas con m√°xima precisi√≥n, enfoc√°ndote en las relaciones sem√°nticas mientras consideras la proximidad temporal.

A continuaci√≥n encontrar√°s una serie de mensajes con sus IDs, marcas de tiempo, nombres de usuario y contenido:

[MESSAGES]

Reglas para el an√°lisis:

1. IDENTIFICACI√ìN PRECISA:
   - Usa EXACTAMENTE el message_id num√©rico de cada mensaje de entrada (ej. 36569, 36570)
   - Cada message_id en la salida DEBE coincidir con un message_id de entrada
   - No inventes nuevos IDs ni uses strings como "CONVERSATION_1"

2. AGRUPACI√ìN SEM√ÅNTICA AVANZADA:
   - Asigna conversation_id como enteros comenzando desde 1 (1, 2, 3, etc.) para mensajes no spam
   - Agrupa por contenido sem√°ntico Y proximidad temporal:
     * Los mensajes dentro de 1 hora tienen mayor probabilidad de pertenecer a la misma conversaci√≥n
     * Mensajes que comparten terminolog√≠a t√©cnica espec√≠fica probablemente pertenecen a la misma conversaci√≥n
     * Busca continuidad tem√°tica y patrones de interacci√≥n entre usuarios (ej. mismos usuarios contestando)
   - Cada mensaje recibe exactamente un conversation_id
   - La coherencia sem√°ntica debe tener prioridad sobre la proximidad temporal cuando hay evidencia clara

3. DETECCI√ìN DE SPAM MEJORADA:
   - Asigna conversation_id = 0 y topic = "Spam Messages" para:
     * Contenido promocional (ej. "¬°BITCOIN GRATIS!")
     * Mensajes repetitivos o id√©nticos enviados por el mismo usuario
     * Enlaces sospechosos (ej. "haz clic aqu√≠", URL acortadas sin contexto)
     * Promesas irrealistas (ej. "ganancias garantizadas del 1000%")
     * Exceso de puntuaci√≥n/emojis (ej. "!!!", "üéâüéâüéâ")
     * Mensajes que solicitan acciones urgentes sin justificaci√≥n

4. ETIQUETADO T√âCNICO DE TEMAS:
   - S√© espec√≠fico y descriptivo (ej. "An√°lisis de Precio BTC Q1 2025" en lugar de "Discusi√≥n Crypto")
   - Incluye t√©rminos t√©cnicos clave cuando est√©n presentes (ej. "Airdrop de Empire X", "Asociaci√≥n con NotSoin")
   - Captura el enfoque principal t√©cnico de cada conversaci√≥n
   - Evita etiquetas vagas o gen√©ricas
   - Prefiere t√©rminos t√©cnicos precisos sobre descripciones generales
   - Mant√©n consistencia en el nivel de especificidad entre las etiquetas

5. REQUISITOS T√âCNICOS:
   - Preserva la marca de tiempo EXACTA de cada mensaje de entrada (ej. "2025-01-14T01:22:56Z")
   - La confianza (0.0-1.0) debe reflejar:
     * Claridad de la relaci√≥n tem√°tica (mayor si los mensajes claramente se relacionan)
     * Proximidad temporal (mayor si est√° dentro de 1 hora)
     * Patrones de interacci√≥n de usuarios (mayor si los mismos usuarios est√°n involucrados)
     * Relevancia del contenido del mensaje (mayor si el contenido se alinea fuertemente)
     * Coherencia del lenguaje t√©cnico utilizado
   - Salida SOLO datos CSV comenzando con la fila de encabezado: message_id,conversation_id,topic,timestamp,confidence
   - SIN comillas alrededor de los campos, SIN texto adicional, SIN explicaciones‚Äîsolo l√≠neas CSV

Retorna solamente los datos CSV comenzando con la fila de encabezado:
message_id,conversation_id,topic,timestamp,confidence
""" 